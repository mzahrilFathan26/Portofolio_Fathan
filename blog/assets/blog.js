// ==================== Data Dummy Post ====================
const POSTS = [
  {
    id: "introduksi-template-blog",
    title: "KESAN PERTAMA SAYA DI NUSA PUTRA DAN HARAPAN YANG AKAN DATANG",
    date: "2025-09-13",
    author: "MZ Fathan",
    category: "Cerita",
    tags: ["MABIM2025", "MELINTASIWAKTUMEMBUKAMASADEPAN"],
    cover: "images1/blog.jpeg",
    excerpt:
      "Pengalaman awal saya di Nusa Putra membuka wawasan dan memberikan banyak pelajaran, sekaligus menumbuhkan harapan untuk perjalanan yang lebih bermakna ke depan.",
    body: `
    <div class="f">
          <h2>KESAN PERTAMA SAYA DI NUSA PUTRA DAN HARAPAN YANG AKAN DATANG</h2>
          <h5>Pengalaman awal saya di Nusa Putra membuka wawasan dan memberikan banyak pelajaran, sekaligus menumbuhkan harapan untuk perjalanan yang lebih bermakna ke depan.</h5>
          <p>Perkenalkan, nama saya Muhammad Zahril Fathan, Biasa dipanggil Fathan. Sekarang saya baru akan menjalani perkuliahan S1 di Universitas Nusa Putra, mengambil jurusan Teknik Informatika. Alhamdulillah, saya bisa langsung melanjutkan kuliah setelah lulus SMK pada tahun 2025, sebuah hal yang sejak lama saya syukuri.</p>
          <p>Saya diterima di Universitas Nusa Putra melalui jalur Mandiri Prestasi Akademik dengan menggunakan nilai rapor. Bagi saya, kesempatan ini sangat berarti, karena perjalanan untuk bisa kuliah tentu bukan hal yang mudah.</p>
          <p>Sejak lama saya memiliki minat besar di bidang teknologi, sehingga memilih Teknik Informatika adalah keputusan yang sudah saya impikan. Harapan saya, selama berkuliah di sini saya bisa menambah ilmu, mengasah keterampilan, serta nantinya mampu memberikan kontribusi positif di bidang yang saya tekuni.</p>
          <p>Memulai perjalanan sebagai mahasiswa baru di Universitas Nusa Putra merupakan pengalaman yang tidak akan saya lupakan. Semuanya bermula dari kegiatan MABIM, yang penuh dengan cerita menarik, ilmu baru, serta rasa kebersamaan yang kuat. Saat pertama kali mengikuti acara tersebut, saya sempat merasa canggung karena harus beradaptasi dengan teman-teman baru dan suasana kampus yang begitu berbeda dari masa sekolah. Namun, seiring berjalannya waktu, perlahan saya merasa nyaman, dan yakin bahwa kampus ini akan menjadi rumah kedua saya.</p>
          <p>Saat mengikuti kegiatan MABIM, ada satu hal yang sangat membekas bagi saya, yaitu ketika diperkenalkan dengan Trilogi Nusa Putra. Bukan hanya sekadar rangkaian kata dalam bahasa Latin, tetapi ada makna mendalam yang membuat saya melihat hidup dengan cara berbeda.</p>
          <h3>Trilogi itu terdiri dari tiga prinsip utama:</h3>
          <li>1. Amor Deus (Cinta Kepada Tuhan)</li>
          <p>Sebagai anugerah cahaya insan Nusa Putra untuk tetap menjalankan syariat agama, beragama merupakan kebutuhan dan cinta kita kepada Tuhan, bukan lagi sebagai kewajiban. Bagi saya, Amor Deus atau cinta kepada Tuhan adalah fondasi utama dalam hidup. Artinya, apa pun yang saya lakukan seharusnya selalu berlandaskan pada rasa syukur dan keyakinan bahwa Tuhan adalah sumber dari segala sesuatu. Cinta kepada Tuhan bukan hanya ditunjukkan lewat doa atau ibadah, tapi juga lewat sikap sehari-hari seperti berbuat jujur, tidak menyakiti orang lain, dan berusaha memberikan manfaat.</p>
          <li>2. Amor Parentium (Cinta Kepada Orang Tua)</li>
          <p>Sebagai kekuatan insan Nusa Putra untuk menjaga ajaran dan nilai-nilai luhur rasul, leluhur, kedua orang tua dan guru-guru kita serta orang orang soleh sebelum kita. Menurut saya, Amor Parentium atau cinta kepada orang tua adalah salah satu nilai yang paling penting dalam hidup. Orang tua adalah sosok yang sejak awal berjuang tanpa henti demi anaknya, mulai dari merawat, mendidik, sampai mendoakan yang terbaik. Bagi saya, mencintai orang tua bukan hanya dengan kata-kata, tetapi juga dengan sikap. Misalnya berusaha patuh, tidak menyakiti hati mereka, dan membuat mereka bangga lewat pencapaian yang saya raih.</p>
          <li>3. Amor Conservis (Cinta Kepada Sesama)</li>
          <p>Sebagai pengikat insan Nusa Putra untuk menjalani hidup berdampingan secara damai dalam menyikapi setiap perbedaan, karena Tuhan berkehendak atas adanya perbedaan itu sendiri. Bagi saya, Amor Conservis atau cinta kepada sesama berarti bagaimana kita bisa hidup berdampingan dengan orang lain dengan saling menghargai, membantu, dan peduli. Manusia tidak bisa hidup sendirian kita butuh teman, sahabat, bahkan orang-orang baru yang kita temui di perjalanan hidup. Dengan memiliki rasa cinta kepada sesama, kita belajar untuk lebih peka, tidak egois, dan mau berbagi kebaikan.</p>
          <p>Selama mengikuti kegiatan MABIM di Universitas Nusa Putra menjadi pengalaman yang sangat berkesan bagi saya. Dari awal hingga akhir, saya merasa banyak mendapatkan ilmu baru, teman baru, dan juga suasana kebersamaan yang hangat. Awalnya memang ada rasa canggung karena harus beradaptasi dengan lingkungan kampus, tapi berkat MABIM saya bisa lebih mengenal universitas ini, sekaligus merasakan semangat yang sama dari teman-teman seperjuangan.</p>
          <p>Pesan yang paling saya tangkap dari MABIM adalah bahwa kehidupan kuliah bukan sekadar mengejar nilai akademik. Lebih dari itu, kuliah juga tentang membentuk karakter, menumbuhkan rasa tanggung jawab, serta belajar bagaimana bekerja sama dengan orang lain. Materi tentang Trilogi Nusa Putra juga memberi saya sudut pandang baru tentang bagaimana seharusnya seorang mahasiswa menjalani kehidupan, baik di kampus maupun di masyarakat.</p>
          <p>Harapan saya setelah melewati MABIM adalah bisa terus berkembang menjadi pribadi yang lebih baik. Saya ingin aktif, tidak hanya di ruang kelas, tetapi juga dalam kegiatan kampus dan sosial. Semoga pengalaman yang saya dapat selama MABIM bisa menjadi bekal untuk menghadapi tantangan di masa kuliah, sekaligus menjadi motivasi untuk mewujudkan mimpi dan memberikan manfaat bagi orang lain.</p>
       </div>
          `,
  },
 /* {
    id: "desain-sistem-token",
    title: "Desain Sistem Token Warna untuk Dark Mode",
    date: "2025-09-18",
    author: "Irpan",
    category: "Desain",
    tags: ["UI", "Dark Mode"],
    cover:
      "https://images.unsplash.com/photo-1526481280698-8fcc13fd1b4d?q=80&w=1280&auto=format&fit=crop",
    excerpt:
      "Belajar menyusun design tokens agar tampilan konsisten di light & dark mode.",
    body: `
          <p>Dengan CSS variables, kamu bisa membuat tema yang konsisten dan mudah diatur.</p>
          <pre><code>:root{ --surface:#fff; --text:#0f172a }\nhtml[data-theme="dark"]{ --surface:#0b1020; --text:#e5e7eb }</code></pre>
          <p>Gunakan class/atribut pada <code>&lt;html&gt;</code> untuk mengganti tema.</p>
        `,
  },
  {
    id: "tips-performa-web",
    title: "Tips Performa Web: Kecilkan, Tunda, Cache!",
    date: "2025-08-05",
    author: "MZ Fathan",
    category: "Programming",
    tags: ["Performance", "Best Practice"],
    cover:
      "https://images.unsplash.com/photo-1498050108023-c5249f4df085?q=80&w=1280&auto=format&fit=crop",
    excerpt: "Beberapa prinsip sederhana yang meningkatkan kecepatan loading.",
    body: `
          <p>Mulai dari gambar terkompres, lazy loading, dan minimalkan blocking scripts.</p>
          <p>Implementasikan strategi caching agar kunjungan berikutnya makin cepat.</p>
        `,
  },*/
  // Tambahkan artikel lain sesuka kamu
];

// ==================== State & Helpers ====================
const state = {
  q: "",
  category: "Semua",
  page: 1,
  perPage: 6,
};

const el = (sel) => document.querySelector(sel);
const els = (sel) => Array.from(document.querySelectorAll(sel));

const formatDate = (iso) =>
  new Date(iso + "T00:00:00").toLocaleDateString("id-ID", {
    year: "numeric",
    month: "long",
    day: "numeric",
  });

// ==================== Render Chips (Kategori) ====================
const categories = [
  "Semua",
  ...Array.from(new Set(POSTS.map((p) => p.category))),
];
function renderChips() {
  const wrap = el("#chips");
  wrap.innerHTML = "";
  categories.forEach((cat) => {
    const a = document.createElement("button");
    a.className = "chip" + (state.category === cat ? " active" : "");
    a.textContent = cat;
    a.setAttribute("aria-pressed", state.category === cat);
    a.addEventListener("click", () => {
      state.category = cat;
      state.page = 1;
      routeTo("#");
      render();
    });
    wrap.appendChild(a);
  });
}

// ==================== Filter & Paginate ====================
function getFiltered() {
  const q = state.q.trim().toLowerCase();
  let items = POSTS.slice().sort((a, b) => new Date(b.date) - new Date(a.date));
  if (state.category !== "Semua")
    items = items.filter((p) => p.category === state.category);
  if (q)
    items = items.filter(
      (p) =>
        p.title.toLowerCase().includes(q) || p.excerpt.toLowerCase().includes(q)
    );
  return items;
}

function paginate(items) {
  const total = Math.ceil(items.length / state.perPage) || 1;
  const start = (state.page - 1) * state.perPage;
  return { items: items.slice(start, start + state.perPage), total };
}

// ==================== Render Grid ====================
function renderGrid() {
  const grid = el("#grid");
  const { items, total } = paginate(getFiltered());
  grid.innerHTML = "";
  items.forEach((p) => {
    const card = document.createElement("article");
    card.className = "card";
    card.innerHTML = `
          <a href="#post/${p.id}" class="thumb"><img loading="lazy" src="${
      p.cover
    }" alt="${p.title}"></a>
          <div class="card-body">
            <div class="meta">
              <span>${p.category}</span> · <time datetime="${
      p.date
    }">${formatDate(p.date)}</time>
            </div>
            <a href="#post/${p.id}" class="title">${p.title}</a>
            <p class="desc">${p.excerpt}</p>
          </div>
        `;
    grid.appendChild(card);
  });
  renderPagination(total);
}

function renderPagination(total) {
  const nav = el("#pagination");
  nav.innerHTML = "";
  const makeBtn = (label, page, disabled = false) => {
    const b = document.createElement("button");
    b.className = "btn";
    b.textContent = label;
    b.disabled = disabled;
    b.addEventListener("click", () => {
      state.page = page;
      window.scrollTo({ top: 0, behavior: "smooth" });
      renderGrid();
    });
    return b;
  };
  nav.appendChild(makeBtn("«", 1, state.page === 1));
  nav.appendChild(makeBtn("‹", Math.max(1, state.page - 1), state.page === 1));
  const info = document.createElement("span");
  info.style.padding = ".6rem 1rem";
  info.textContent = `Hal ${state.page} dari ${total}`;
  nav.appendChild(info);
  nav.appendChild(
    makeBtn("›", Math.min(total, state.page + 1), state.page === total)
  );
  nav.appendChild(makeBtn("»", total, state.page === total));
}

// ==================== Post Detail ====================
function renderPost(id) {
  const p = POSTS.find((x) => x.id === id);
  if (!p) {
    routeTo("#");
    return;
  }
  el("#postTitle").textContent = p.title;
  el("#postMeta").innerHTML = `${p.author} · <time datetime="${
    p.date
  }">${formatDate(p.date)}</time>`;
  el("#postCover").src = p.cover;
  el("#postCover").alt = p.title;
  el("#postBody").innerHTML = p.body;
  const tags = el("#postTags");
  tags.innerHTML = "";
  p.tags?.forEach((t) => {
    const s = document.createElement("span");
    s.className = "tag";
    s.textContent = `#${t}`;
    tags.appendChild(s);
  });
}

// ==================== Router Sederhana ====================
function routeTo(hash) {
  window.location.hash = hash;
}
function router() {
  const hash = decodeURIComponent(window.location.hash || "#");
  const [path, param] = hash.replace("#", "").split("/");
  if (path === "post" && param) {
    el("#homeView").hidden = true;
    el("#postView").hidden = false;
    renderPost(param);
  } else if (path === "kategori" && param) {
    state.category = param;
    state.page = 1;
    el("#postView").hidden = true;
    el("#homeView").hidden = false;
    render();
  } else {
    el("#postView").hidden = true;
    el("#homeView").hidden = false;
    render();
  }
}

// ==================== Theme Toggle ====================
function applyTheme(t) {
  document.documentElement.setAttribute("data-theme", t);
  localStorage.setItem("theme", t);
  const isDark = t === "dark";
  el("#sun").style.display = isDark ? "none" : "";
  el("#moon").style.display = isDark ? "" : "none";
}

// ==================== Animasi Masuk ====================
const io = new IntersectionObserver(
  (entries) => {
    entries.forEach((e) => {
      if (e.isIntersecting) e.target.classList.add("in");
    });
  },
  { threshold: 0.05 }
);

// ==================== Init ====================
function init() {
  // Tahun
  el("#year").textContent = new Date().getFullYear();

  // Theme
  applyTheme(
    localStorage.getItem("theme") ||
      (window.matchMedia("(prefers-color-scheme: dark)").matches
        ? "dark"
        : "light")
  );
  el("#themeToggle").addEventListener("click", () =>
    applyTheme(
      document.documentElement.getAttribute("data-theme") === "dark"
        ? "light"
        : "dark"
    )
  );
  el("#mobileTheme").addEventListener("click", () =>
    applyTheme(
      document.documentElement.getAttribute("data-theme") === "dark"
        ? "light"
        : "dark"
    )
  );

  // Search
  const search = el("#search");
  const updateQ = () => {
    state.q = search.value;
    state.page = 1;
    renderGrid();
  };
  search.addEventListener("input", updateQ);
  window.addEventListener("keydown", (e) => {
    if ((e.ctrlKey || e.metaKey) && e.key === "/") {
      e.preventDefault();
      search.focus();
    }
  });

  // Chips
  renderChips();

  // Render pertama
  renderGrid();

  // Animasi
  els("[data-animate]").forEach((n) => io.observe(n));

  // Router
  window.addEventListener("hashchange", router);
  router();

  // Hamburger + Drawer
  const hamb = el("#hamb");
  const drawer = el("#drawer");
  const openDrawer = () => {
    drawer.classList.add("active");
    hamb.classList.add("active");
  };
  const closeDrawer = () => {
    drawer.classList.remove("active");
    hamb.classList.remove("active");
  };
  hamb.addEventListener("click", () =>
    drawer.classList.contains("active") ? closeDrawer() : openDrawer()
  );
  drawer.addEventListener("click", (e) => {
    if (e.target.hasAttribute("data-close")) closeDrawer();
  });
  document.addEventListener("click", (e) => {
    // klik di luar hamb saat terbuka → tutup
    if (drawer.classList.contains("active")) {
      const panel = drawer.querySelector(".panel");
      if (!panel.contains(e.target) && !hamb.contains(e.target)) closeDrawer();
    }
  });

  // Reset filter
  el("#clearFilters").addEventListener("click", () => {
    state.q = "";
    el("#search").value = "";
    state.category = "Semua";
    state.page = 1;
    render();
  });
}

function render() {
  renderChips();
  renderGrid();
}

document.addEventListener("DOMContentLoaded", init);
document.addEventListener("DOMContentLoaded", function () {
  const modal = document.getElementById("aboutModal");
  const openBtn = document.querySelector('a[href="#tentang"]');
  const closeBtn = modal.querySelector(".close-btn");

  if (!modal || !openBtn || !closeBtn) {
    console.warn("Elemen popup tidak ditemukan!");
    return;
  }
});

document.addEventListener("DOMContentLoaded", function () {
  const modal = document.getElementById("aboutModal");
  const closeBtn = modal.querySelector(".close-btn");

  // Klik tombol "Tentang" → pakai delegation
  document.body.addEventListener("click", function (e) {
    const target = e.target.closest('a[href="#tentang"]');
    if (target) {
      e.preventDefault();
      modal.style.display = "flex";
    }
  });

  // Klik tombol "X"
  closeBtn.addEventListener("click", function () {
    modal.style.display = "none";
  });

  // Klik di luar modal
  window.addEventListener("click", function (e) {
    if (e.target === modal) {
      modal.style.display = "none";
    }
  });
});
